<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Tienda Virtual - Usuarios</title>

    <script>

        const URL_USUARIOS = "https://ms-usuarios-production-3f9e.up.railway.app";

        // LISTAR USUARIOS
        async function listar() {

            console.log("Listando usuarios...");

            try {

                const response = await fetch(URL_USUARIOS + "/usuarios/listar");

                if (!response.ok) {
                    throw new Error("Error HTTP: " + response.status);
                }

                const data = await response.json();

                console.log("Usuarios recibidos:", data);

                const tabla = document.getElementById("tablaUsuarios");

                tabla.innerHTML = "";

                if (!Array.isArray(data)) {
                    console.error("La respuesta no es un array:", data);
                    return;
                }

                for (let i = 0; i < data.length; i++) {

                    const u = data[i];

                    const fila =
                        "<tr>" +
                        "<td>" + (u.cedulaUsuario ?? "") + "</td>" +
                        "<td>" + (u.nombreUsuario ?? "") + "</td>" +
                        "<td>" + (u.emailUsuario ?? "") + "</td>" +
                        "<td>" + (u.usuario ?? "") + "</td>" +
                        "</tr>";

                    tabla.innerHTML += fila;
                }

            } catch (error) {

                console.error("Error al listar:", error);

            }
        }


        // GUARDAR USUARIO
        async function guardar() {

            const usuario = {

                cedulaUsuario: document.getElementById("cedula").value,
                nombreUsuario: document.getElementById("nombreUsuario").value,
                emailUsuario: document.getElementById("emailUsuario").value,
                usuario: document.getElementById("usuario").value,
                password: document.getElementById("password").value

            };

            try {

                const response = await fetch(URL_USUARIOS + "/usuarios/guardar", {

                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(usuario)

                });

                if (!response.ok) {
                    throw new Error("Error al guardar: " + response.status);
                }

                alert("Usuario guardado correctamente");

                listar();

            } catch (error) {

                console.error("Error al guardar:", error);
                alert("Error al guardar usuario");

            }
        }


        // ELIMINAR USUARIO
        async function eliminar() {

            const id = document.getElementById("idEliminar").value;

            if (!id) {
                alert("Ingrese el ID");
                return;
            }

            try {

                const response = await fetch(URL_USUARIOS + "/usuarios/eliminar/" + id, {

                    method: "DELETE"

                });

                if (!response.ok) {
                    throw new Error("Error al eliminar");
                }

                alert("Usuario eliminado correctamente");

                listar();

            } catch (error) {

                console.error("Error al eliminar:", error);
                alert("Error al eliminar usuario");

            }
        }


        // CARGAR AL INICIAR
        window.onload = listar;

    </script>

</head>

<body>

    <h2>Tienda Virtual</h2>

    <nav>
        <a href="index.html">Inicio</a> |
        <a href="usuarios.html">Usuarios</a> |
        <a href="clientes.htnl">Clientes</a> |
        <a href="proveedores.html">Proveedores</a> |
        <a href="productos.html">Productos</a> |
        <a href="ventas.html">Ventas</a> |
        <a href="reportes.html">Reportes</a>
    </nav>

    <hr/>

    <h3>Gestión de Usuarios</h3>

    <table border="1">

        <tr>
            <td>Cédula:</td>
            <td><input type="text" id="cedula"/></td>

            <td>Usuario:</td>
            <td><input type="text" id="usuario"/></td>
        </tr>

        <tr>
            <td>Nombre Completo:</td>
            <td><input type="text" id="nombreUsuario"/></td>

            <td>Contraseña:</td>
            <td><input type="password" id="password"/></td>
        </tr>

        <tr>
            <td>Correo Electrónico:</td>
            <td><input type="text" id="emailUsuario"/></td>
        </tr>

        <tr>
            <td colspan="4">
                <input type="button" value="Guardar" onclick="guardar()"/>
            </td>
        </tr>

    </table>

    <hr/>

    <h3>Eliminar Usuario</h3>

    <table>

        <tr>
            <td>ID MongoDB:</td>
            <td><input type="text" id="idEliminar"/></td>

            <td>
                <input type="button" value="Eliminar" onclick="eliminar()"/>
            </td>
        </tr>

    </table>

    <hr/>

    <h3>Listado de Usuarios</h3>

    <table border="1">

        <thead>
            <tr>
                <th>Cédula</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>Usuario</th>
            </tr>
        </thead>

        <tbody id="tablaUsuarios">
        </tbody>

    </table>

</body>


</html>
